<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>BSRN-Chatprogramm: BSRN-Chatprogramm – Technische Dokumentation</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">BSRN-Chatprogramm
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">BSRN-Chatprogramm – Technische Dokumentation </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="einleitung"></a>
Einleitung</h1>
<p>Das BSRN-Chatprogramm ist ein modular aufgebautes, dezentrales Peer-to-Peer-Kommunikationssystem, das den Austausch von Text- und Bildnachrichten in einem lokalen Netzwerk ermöglicht. Die gesamte Kommunikation erfolgt auf Basis des proprietären Simple Local Chat Protocols (SLCP), das vollständig implementiert wurde.</p>
<p>Ziel der Anwendung ist die systemnahe Entwicklung einer Chat-Lösung, die klassische Konzepte der Betriebssysteme praxisnah umsetzt: insbesondere Prozesse, Interprozesskommunikation (IPC), Sockets, parallele Verarbeitung und Dateikonfiguration.</p>
<p>Das System ist so konzipiert, dass mehrere Instanzen gleichzeitig auf einem oder mehreren Geräten betrieben werden können, ohne dass ein zentraler Server erforderlich ist. Alle Verbindungen sind direkt (Client-to-Client).</p>
<h1><a class="anchor" id="ansatz"></a>
Gewählter Architekturansatz</h1>
<p>Die Softwarearchitektur folgt einem strikt prozessgetrennten Aufbau nach dem Prinzip der Verantwortungsteilung. Jede Hauptkomponente läuft als separater Prozess:</p>
<ul>
<li><b>Benutzeroberflächenprozess (UI)</b> <br  />
 Ermöglicht dem Benutzer das Senden, Empfangen und Anzeigen von Nachrichten. <br  />
 Kommandozeile (CLI) mit interaktiven Textbefehlen</li>
<li><b>Netzwerkprozess</b> <br  />
 Übernimmt das Senden und Empfangen von SLCP-Kommandos. <br  />
 SLCP-Kommandos wie JOIN, LEAVE, MSG, IMG, WHOIS und IAM werden verarbeitet. Für Textnachrichten wird UDP verwendet, für Bilder TCP. Die Verarbeitung ist eventbasiert und erfolgt asynchron.</li>
<li><b>Discoveryprozess</b> <br  />
 Lauscht permanent auf WHOIS-Broadcasts über UDP und antwortet gegebenenfalls mit IAM. Zusätzlich verarbeitet er WHOIS-Anfragen, die intern von der Benutzeroberfläche kommen. IAM-Antworten werden zurück an die UI geleitet.</li>
</ul>
<p>Die drei Prozesse kommunizieren ausschließlich über Multiprocessing-Queues (z. B. <code>queue_ui_to_net</code>, <code>queue_net_to_ui</code>, <code>queue_ui_to_discovery</code>, <code>queue_discovery_to_ui</code>). Dadurch wird eine vollständige Trennung der Zuständigkeiten, sowie Thread- und Prozesssicherheit gewährleistet.</p>
<p>Die gesamte Architektur ist darauf ausgelegt, parallelisierbar, fehlertolerant und erweiterbar zu sein. Ressourcen wie Ports oder IPs werden zur Laufzeit aus der Konfigurationsdatei <code>config.toml</code> dynamisch geladen.</p>
<div class="image">
<img src="img/architektur.png" alt=""/>
<div class="caption">
Systemarchitektur mit drei gekapselten Hauptprozessen</div></div>
<h1><a class="anchor" id="funktionen"></a>
Hauptfunktionen</h1>
<p>Das BSRN-Chatprogramm bietet eine Vielzahl an Funktionen, die sowohl aus Benutzersicht als auch aus technischer Sicht relevant sind. Alle Funktionen sind vollständig in der SLCP-Logik verankert und durch Queues und Prozesse getrennt implementiert.</p>
<ul>
<li><b>Textnachrichten (MSG)</b> <br  />
 Direkter Versand von Kurznachrichten über UDP oder TCP an andere bekannte Clients im Netzwerk. Nachrichten werden in der CLI sofort dargestellt. Bilder werden empfangen, gespeichert und ihr Speicherpfad ausgegeben.</li>
<li><b>Bildübertragung (IMG)</b> <br  />
 Bilder werden zunächst per SLCP-Kommando mit <code>IMG &lt;Handle&gt; &lt;Size&gt;</code> angekündigt. <br  />
 Anschließend erfolgt die Übertragung des Bildes über TCP in der exakt spezifizierten Länge. .</li>
<li><b>Teilnehmererkennung (WHOIS/IAM)</b> <br  />
 Jeder Client kann per UDP-Broadcast ermitteln, ob ein bestimmter Benutzername (Handle) im Netzwerk vorhanden ist. <br  />
 Der passende Client antwortet direkt mit einer IAM-Nachricht inklusive IP-Adresse und Port.</li>
<li><b>Peer-Verwaltung (intern)</b> <br  />
 Alle bekannten Teilnehmer werden mit IP und Port in einem <code>peers</code>-Dictionary verwaltet. <br  />
 Diese Informationen werden bei Nachrichtenübertragung oder IAM-Erkennung automatisch aktualisiert.</li>
<li><b>Autoreply bei Abwesenheit</b> <br  />
 Optional kann in der Konfigurationsdatei ein Autoreply-Text hinterlegt werden. <br  />
 Wenn ein WHOIS empfangen wird, antwortet der Client automatisch per MSG mit diesem Text.</li>
<li><b>Netzwerkmodus</b> <br  />
 Das System unterstützt echte Netzwerkinstallationen (z. B. zwei Rechner) <br  />
</li>
</ul>
<h1><a class="anchor" id="protokoll"></a>
Protokollimplementierung (SLCP)</h1>
<p>Das Projekt implementiert das vollständige Simple Local Chat Protocol (SLCP) gemäß Spezifikation. <br  />
 Jede Nachricht ist eine UTF-8-codierte Textzeile mit genau einem UNIX-Zeilenumbruch <code>\n</code>. <br  />
 Parameter mit Leerzeichen werden in doppelte Anführungszeichen gesetzt.</p>
<p>Unterstützte Kommandos:</p>
<ul>
<li><code>JOIN &lt;Handle&gt; &lt;Port&gt;</code> <br  />
 Anmeldung eines Clients im Netzwerk – gesendet als UDP-Broadcast.</li>
<li><code>LEAVE &lt;Handle&gt;</code> <br  />
 Abmeldung eines Clients – ebenfalls über UDP-Broadcast verteilt.</li>
<li><code>WHOIS &lt;Handle&gt;</code> <br  />
 Erkundung eines bestimmten Benutzers per UDP-Broadcast.</li>
<li><code>IAM &lt;Handle&gt; &lt;IP&gt; &lt;Port&gt;</code> <br  />
 Direktantwort auf WHOIS per UDP oder TCP mit IP-Adresse und Port.</li>
<li><code>MSG &lt;Handle&gt; &lt;Text&gt;</code> <br  />
 Textnachricht direkt an einen bestimmten Empfänger – via UDP oder TCP.</li>
<li><code>IMG &lt;Handle&gt; &lt;Size&gt;</code> <br  />
 Ankündigung eines Bildversands. Der eigentliche Binärtransfer erfolgt danach über TCP.</li>
</ul>
<hr  />
<p> <b>Technische Einschränkungen:</b></p><ul>
<li>Alle Nachrichten müssen UTF-8-codiert sein</li>
<li>Maximale Länge: 512 Bytes pro Nachricht</li>
</ul>
<div class="image">
<img src="img/chatablauf.png" alt=""/>
<div class="caption">
Ablaufdiagramm der Nachrichtenübertragung über SLCP</div></div>
<h1><a class="anchor" id="bedienung"></a>
Bedienung der Anwendung</h1>
<ul>
<li><b>Benutzeroberfläche (CLI)</b> <br  />
 Die gesamte Bedienung erfolgt über Kommandozeilenbefehle.</li>
</ul>
<p>Anschließend wird der Benutzername (Handle) eingegeben, der für alle SLCP-Kommandos verwendet wird. Die Konfigurationsdatei <code>config.toml</code> dient als zentrales Steuerungselement und enthält folgende Parameter:</p>
<ul>
<li><code>handle</code> – Benutzername</li>
<li><code>port_range</code> – Portbereich für Netzwerkverbindungen</li>
<li><code>whoisport</code> – Port für WHOIS-Broadcast</li>
<li><code>autoreply</code> – Antworttext bei Abwesenheit</li>
<li><code>imagepath</code> – Speicherort für empfangene Bilder</li>
</ul>
<hr  />
<p> In der <b>CLI</b> erfolgt die Steuerung rein textbasiert über folgende Kommandos:</p>
<ul>
<li><code>join</code> – Anmeldung im Netzwerk</li>
<li><code>leave</code> – Abmeldung vom Chat</li>
<li><code>msg &lt;Empfänger&gt; &lt;Nachricht&gt;</code> – Textnachricht senden</li>
<li><code>img &lt;Empfänger&gt; &lt;Pfad-zum-Bild&gt;</code> – Bild senden</li>
<li><code>whois &lt;Handle&gt;</code> – Teilnehmer im Netzwerk suchen</li>
<li><code>autoreply &lt;Text&gt;</code> – Abwesenheitstext setzen</li>
<li><code>config</code> – Konfigurationswerte anzeigen</li>
<li><code>exit</code> – Programm beenden (sichert LEAVE)</li>
</ul>
<p>Eingehende Nachrichten und IAM-Antworten werden sofort im Terminal ausgegeben.</p>
<div class="image">
<img src="img/cli_example.png" alt=""/>
<div class="caption">
CLI mit JOIN, MSG, WHOIS und Rückmeldungen</div></div>
<p>Änderungen an Konfiguration oder Autoreply werden direkt in <code>config.toml</code> übernommen. Beim Beenden (z. B. durch Schließen des Fensters oder „Beenden“-Button) wird automatisch ein <code>LEAVE &lt;Handle&gt;</code>-Befehl per UDP-Broadcast gesendet.</p>
<h1><a class="anchor" id="probleme"></a>
Teilprobleme und Lösungen</h1>
<p>Im Laufe der Entwicklung des Chatprogramms traten mehrere technische Herausforderungen auf, die im Rahmen der Projektumsetzung systematisch gelöst wurden. Nachfolgend sind die wichtigsten Probleme inklusive ihrer jeweiligen Lösung dokumentiert.</p>
<hr  />
<ul>
<li><b>UDP-Broadcast funktioniert nicht auf allen Netzwerkschnittstellen</b> <br  />
 Problem: Manche Systeme ignorieren UDP-Broadcasts, wenn an eine bestimmte IP-Adresse gebunden wird. <br  />
 Lösung: Der UDP-Socket wird explizit an &lsquo;'0.0.0.0&rsquo;<code>gebunden (leerer String im Code</code>""`), wodurch alle verfügbaren Interfaces lauschen. <br  />
 Zusätzlich wird die lokale IP-Adresse dynamisch über eine "Dummy-Verbindung" zu 8.8.8.8 ermittelt: <div class="fragment"><div class="line">s.connect((&quot;8.8.8.8&quot;, 80))</div>
<div class="line">ip = s.getsockname()[0]</div>
</div><!-- fragment --> Dadurch kann bei WHOIS/IAM-Nachrichten stets die korrekte IP übermittelt werden.</li>
</ul>
<hr  />
<ul>
<li><b>Mehrere Clients auf demselben Gerät gleichzeitig starten</b> <br  />
 Problem: Bei statischer Portbelegung würden parallele Instanzen auf demselben Rechner zu Portkonflikten führen. <br  />
 Lösung: Die Datei <code>config.toml</code> enthält ein konfigurierbares <code>port_range</code>-Feld. <br  />
 Beim Start durchsucht das Programm diesen Bereich nach dem ersten freien Port und reserviert ihn für den Client. <br  />
 Die Information wird zusätzlich unter <code>[[clients]]</code> gespeichert, damit bekannte Benutzerports erhalten bleiben.</li>
</ul>
<hr  />
<ul>
<li><b>Bildübertragung über SLCP scheitert an Protokollgrenzen</b> <br  />
 Problem: SLCP erlaubt nur textbasierte Nachrichten mit maximal 512 Bytes. <br  />
 Lösung: Der Bildversand erfolgt zweistufig:<ol type="1">
<li>Der Header <code>IMG &lt;Handle&gt; &lt;Size&gt;|&lt;Kommentar&gt;</code> wird als SLCP-Nachricht gesendet.</li>
<li>Die tatsächlichen Bilddaten werden direkt im Anschluss über eine separate TCP-Verbindung übertragen. <br  />
 Die Anzahl der Bytes entspricht exakt dem im Header angegebenen Wert. Der Empfänger liest die Binärdaten blockweise, bis die erwartete Größe erreicht ist.</li>
</ol>
</li>
</ul>
<hr  />
<ul>
<li><b>Discoveryprozess darf nicht doppelt laufen</b> <br  />
 Problem: Wenn mehrere Clients gleichzeitig auf einem System laufen, würde ein mehrfach gestarteter Discoveryprozess mehrfach auf Port 4000 lauschen – was zu einem <code>OSError</code> führt. <br  />
 Lösung: Es wird pro Startprozess entschieden, ob eine eigene Discovery-Instanz notwendig ist. <br  />
 WHOIS-Anfragen aus der UI werden über IPC-Queues an den Discoveryprozess delegiert. <br  />
 IAM-Antworten werden gezielt nur an den anfragenden Port gesendet, nicht gebroadcastet.</li>
</ul>
<hr  />
<ul>
<li><b>Autoreply auf WHOIS-Anfragen erforderlich</b> <br  />
 Problem: Der Nutzer soll erkennen, wenn ein Teilnehmer "nicht aktiv" ist, obwohl er erreichbar ist. <br  />
 Lösung: In <code>config.toml</code> kann ein Autoreply-Text definiert werden. <br  />
 Wird eine WHOIS-Anfrage empfangen und der Benutzer ist nicht aktiv (CLI inaktiv), wird automatisch eine <code>MSG &lt;Handle&gt; &lt;Autoreply&gt;</code> an den Anfragenden gesendet. Die Logik befindet sich im Netzwerkprozess und prüft dabei: <div class="fragment"><div class="line">if sender != handle and get_config_value(&quot;autoreply&quot;):</div>
<div class="line">    reply = get_config_value(&quot;autoreply&quot;)</div>
<div class="line">    auto_msg = build_message(&quot;MSG&quot;, handle, reply)</div>
<div class="line">    send_direct_udp(sender, auto_msg)</div>
</div><!-- fragment --></li>
</ul>
<h1><a class="anchor" id="erweiterbarkeit"></a>
Erweiterungspotenzial</h1>
<p>Durch den modularen Aufbau des BSRN-Chatprogramms ist die Anwendung ohne nennenswerte strukturelle Änderungen erweiterbar. Die getrennte Prozessarchitektur und die saubere SLCP-Integration ermöglichen folgende Ausbaustufen:</p>
<ul>
<li><b>Gruppenchats mit mehreren Empfängern</b> <br  />
 Der aktuelle SLCP-Befehl <code>MSG &lt;Handle&gt; &lt;Text&gt;</code> könnte um Mehrfachempfänger erweitert werden: <br  />
 z. B. <code>MSG Alice,Bob,Clara Hallo zusammen</code> oder durch eine Gruppen-ID. <br  />
 Die CLI müsste dazu eine Eingabelogik für Listen oder Gruppen einführen.</li>
<li><b>Transportverschlüsselung (TLS)</b> <br  />
 Der TCP-Kanal für den Bildversand ist derzeit unverschlüsselt. <br  />
 Eine Erweiterung auf TLS (z. B. mit <code>ssl.wrap_socket</code>) würde Vertraulichkeit und Integrität sichern. <br  />
 Dabei müssten Zertifikate generiert, verwaltet und geprüft werden.</li>
<li><b>Persistente Chat-Historie</b> <br  />
 Aktuell werden Nachrichten und Bilder nur temporär verarbeitet. <br  />
 Eine Erweiterung könnte über <code>sqlite3</code>, <code>CSV</code> oder <code>JSON-Logging</code> erfolgen. <br  />
 Die CLI könnte eine <code>history</code>-Funktion oder Exportoption erhalten.</li>
<li><b>Benutzerstatus &amp; Präsenzanzeige</b> <br  />
 Durch regelmäßige „heartbeat“-Nachrichten könnte der Online-Status ermittelt werden. <br  />
 Teilnehmer, die über einen definierten Zeitraum inaktiv bleiben, würden als „offline“ markiert. <br  />
 Die CLI könnte dies mit Symbolen oder Zeitstempeln visualisieren.</li>
<li><b>Integration in bestehende Netzwerke</b> <br  />
 Das System kann ohne Anpassung in LAN-Umgebungen eingesetzt werden. <br  />
 Für den Einsatz über VPN oder im WAN müsste SLCP um NAT-Erkennung, dynamische Portweiterleitung oder Relay-Server ergänzt werden.</li>
</ul>
<hr  />
<h1><a class="anchor" id="autoren"></a>
Autoren</h1>
<ul>
<li>Ayoub Bouda <br  />
</li>
<li>Studiengang: Wirtschaftsinformatik / Informatik <br  />
</li>
<li>Frankfurt University of Applied Sciences <br  />
</li>
<li>Modul: Betriebssysteme und Rechnernetze <br  />
</li>
<li>Semester: Sommersemester 2025 </li>
</ul>
</div></div><!-- PageDoc -->
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
